(function(){function e(){w.canvas.height=window.innerHeight,w.canvas.width=window.innerWidth,w.strokeStyle="gray",w.textBaseline="middle",F=Math.min(w.canvas.height/20,w.canvas.width/17),F=Math.floor(F),w.font=.75*F+"px monospace"}function n(e,n){w.beginPath(),w.rect(e*F,n*F,F,F),w.fill(),w.stroke()}function t(e,t,a){t=t||0;for(var r=0;r<e.length-t;r++)for(var o=t;o<e[r].length-t;o++)(a||e[r][o])&&(w.fillStyle=M[e[r][o]],n(o-t,r))}function a(){if(m.b){if(w.clearRect(0,0,w.canvas.width,w.canvas.height),w.save(),m.p&&(w.globalAlpha=.5),t(m.b,2,!0),w.save(),w.translate((m.x-2)*F,m.y*F),t(m.c),w.restore(),w.save(),w.translate(12*F,2*F),t(m.n,0,!0),w.restore(),!m.p){for(var e=0;!u(m.c,m.x,m.y+e+1);)e++;e&&(w.save(),w.globalAlpha*=.5,w.translate((m.x-2)*F,(m.y+e)*F),t(m.c),w.restore())}w.save(),w.translate(12*F,(18-m.s.length)*F),t(m.s,0,!0),w.restore(),w.restore(),w.fillStyle=m.p&&!m.o?"#666":"#000",w.fillText("Lines: "+m.l,12*F,10*F),m.o&&(w.save(),w.strokeStyle="#F00",w.lineWidth=2,w.font="bold "+3*F+"px monospace",w.textAlign="center",w.fillText("GAME",5*F,7.5*F),w.strokeText("GAME",5*F,7.5*F),w.fillText("OVER",5*F,13*F),w.strokeText("OVER",5*F,13*F),w.restore())}}function r(e){for(var n=[],t=0;t<e[0].length;t++){for(var a=[],r=0;r<e.length;r++)a.push(e[r][t]);n[t]=a}return n}function o(e){for(var n=[],t=0;t<e.length;t++){n[t]=[];for(var a=0;a<e[t].length;a++)n[t][a]=e[t][e[t].length-a-1]}return n}function c(){var e=o(r(m.c));u(e,m.x,m.y)?u(e,m.x,m.y+1)?u(e,m.x+1,m.y)?u(e,m.x-1,m.y)?u(e,m.x+1,m.y+1)?u(e,m.x-1,m.y+1)||(m.c=e,m.x--,m.y++,a()):(m.c=e,m.x++,m.y++,a()):(m.c=e,m.x--,a()):(m.c=e,m.x++,a()):(m.c=e,m.y++,a()):(m.c=e,a())}function l(){u(m.c,m.x-1,m.y)||(m.x--,a())}function i(){u(m.c,m.x+1,m.y)||(m.x++,a())}function f(){for(;!s(););}function s(){m.a=0;var e=u(m.c,m.x,m.y+1);if(e){for(var n=0;n<m.c.length;n++)for(var t=0;t<m.c[n].length;t++)m.c[n][t]&&(m.b[n+m.y][t+m.x]=m.c[n][t]);h(m.y,m.c.length),y(),u(m.c,m.x,m.y)&&p()}else m.y++;return a(),e}function h(e,n){for(var t=Math.min(e+n,m.b.length-2),a=0,r=e;t>r;r++){for(var o=!0,c=2;12>c&&o;c++)o=m.b[r][c]>0&&m.b[r][c]<8;if(o){for(var c=r;c>0;c--)m.b[c]=Array.apply(void 0,m.b[c-1]);m.b[0]=[8,8,0,0,0,0,0,0,0,0,0,0,8,8],m.l++,a++}}switch(a){case 0:break;case 1:m.d*=.95;break;case 2:m.d*=.9;break;case 3:m.d*=.8;break;case 4:m.d*=.7}}function u(e,n,t){for(var a=!1,r=0;r<e.length;r++)for(var o=0;o<e[r].length;o++)a=a||e[r][o]&&m.b[r+t][o+n];return a}function v(){if(m.f&&!u(m.s,5,2)){m.f=!1,m.x=5,m.y=0;var e=m.c;m.c=m.s,m.s=e,a()}}function x(){if(!m.q.length)for(var e=function(e){for(var n,t,a=e.length;0!==a;)t=Math.floor(Math.random()*a),a--,n=e[a],e[a]=e[t],e[t]=n;return e}([0,1,2,3,4,5,6]),n=0;n<e.length;n++)m.q[n]=A[e[n]];return m.q.pop()}function y(){m.x=5,m.y=0,m.f=!0,m.c=m.n,m.n=x()}function g(){m.p||(m.a<m.d?m.a++:s())}function b(){window.onkeydown=function(e){var n=e.keyCode||e.which||0;switch(n){case 13:m.o&&d();break;case 16:m.p||v();break;case 32:m.p||f();break;case 37:m.p||l();break;case 38:m.p||c();break;case 39:m.p||i();break;case 40:m.p||s();break;case 80:m.o||(m.p=!m.p,a());break;case 81:m.p&&p()}},window.onresize=function(){e(),a()}}function p(){m.o=!0,m.p=!0,a()}function d(){m.b=[[8,8,0,0,0,0,0,0,0,0,0,0,8,8],[8,8,0,0,0,0,0,0,0,0,0,0,8,8],[8,8,0,0,0,0,0,0,0,0,0,0,8,8],[8,8,0,0,0,0,0,0,0,0,0,0,8,8],[8,8,0,0,0,0,0,0,0,0,0,0,8,8],[8,8,0,0,0,0,0,0,0,0,0,0,8,8],[8,8,0,0,0,0,0,0,0,0,0,0,8,8],[8,8,0,0,0,0,0,0,0,0,0,0,8,8],[8,8,0,0,0,0,0,0,0,0,0,0,8,8],[8,8,0,0,0,0,0,0,0,0,0,0,8,8],[8,8,0,0,0,0,0,0,0,0,0,0,8,8],[8,8,0,0,0,0,0,0,0,0,0,0,8,8],[8,8,0,0,0,0,0,0,0,0,0,0,8,8],[8,8,0,0,0,0,0,0,0,0,0,0,8,8],[8,8,0,0,0,0,0,0,0,0,0,0,8,8],[8,8,0,0,0,0,0,0,0,0,0,0,8,8],[8,8,0,0,0,0,0,0,0,0,0,0,8,8],[8,8,0,0,0,0,0,0,0,0,0,0,8,8],[8,8,0,0,0,0,0,0,0,0,0,0,8,8],[8,8,0,0,0,0,0,0,0,0,0,0,8,8],[8,8,8,8,8,8,8,8,8,8,8,8,8,8],[8,8,8,8,8,8,8,8,8,8,8,8,8,8]],m.q=[],m.n=x(),m.s=x(),y(),m.l=0,m.d=75,m.a=0,m.p=!1,m.o=!1,a()}function k(){e(),d(),b(),setInterval(g,20)}var w=document.getElementsByTagName("canvas")[0].getContext("2d"),F=0,m={a:0,b:null,c:null,x:0,y:5,n:null,s:null,q:null,f:!1,p:!1,o:!1,l:0,d:0};const M=["#111","#F00","#00F","#0F0","#0FF","#F0F","#FF0","orangered","#CCC"],A=[[[0,0,0,0],[4,4,4,4],[0,0,0,0],[0,0,0,0]],[[2,0,0],[2,2,2],[0,0,0]],[[0,0,7],[7,7,7],[0,0,0]],[[0,0,0,0],[0,6,6,0],[0,6,6,0],[0,0,0,0]],[[0,3,3],[3,3,0],[0,0,0]],[[0,5,0],[5,5,5],[0,0,0]],[[1,1,0],[0,1,1],[0,0,0]]];k()}).call();